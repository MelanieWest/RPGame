webpackJsonp([10],{125:function(e,t,n){"use strict";var i=n(2),o=n.n(i),a=n(0),r=n.n(a),s=n(1),l=n.n(s),c=n(4),u=n.n(c),p=n(3),f=n.n(p),h=n(9),d=n.n(h),m=n(5),v=n.n(m),g=n(10),y=n.n(g),x=n(11),$=n(84),k=this&&this.__decorate||function(e,t,n,i){var o,a=arguments.length,r=a<3?t:null===i?i=y()(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,n,r):o(t,n))||r);return a>3&&r&&d()(t,n,r),r},b=function(e){function t(){return r()(this,t),u()(this,(t.__proto__||o()(t)).apply(this,arguments))}return f()(t,e),l()(t,[{key:"postInit",value:function(){var e=this;this.$element.on("keydown",function(t){e.$scope.leaveEnter||e.$scope.$apply(function(){13==t.which&&t.preventDefault()})})}},{key:"postOnSelect",value:function(){var e=this.$element.val();this.$scope.ngModel=e}}]),t}($.a);b=k([n.i(x.a)({restrict:"EA",scope:{strategies:"=completer",ngModel:"=",leaveEnter:"=?"}})],b),t.a=b},126:function(e,t,n){"use strict";var i=n(2),o=n.n(i),a=n(0),r=n.n(a),s=n(1),l=n.n(s),c=n(4),u=n.n(c),p=n(3),f=n.n(p),h=n(9),d=n.n(h),m=n(5),v=n.n(m),g=n(10),y=n.n(g),x=n(11),k=n(33),b=n(16),w=n(84),C=this&&this.__decorate||function(e,t,n,i){var o,a=arguments.length,r=a<3?t:null===i?i=y()(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":v()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,n,r):o(t,n))||r);return a>3&&r&&d()(t,n,r),r},_=function(e){function t(){return r()(this,t),u()(this,(t.__proto__||o()(t)).apply(this,arguments))}return f()(t,e),l()(t,[{key:"preInit",value:function(){function e(e,t){if(n.ngModel&&void 0!==n.ngModel.isTemplate&&!1===n.ngModel.isTemplate)return void t([]);if(i.entities&&i.entities.length>0){var o=i.UtilsService.trimFirst(e,"@"),a=i.UtilsService.containsInStringOrArrayFn(o),r=$.map(i.entities,function(e){return angular.isObject(e)?a(e.value)||a(e.synonyms)?e.value:null:a(e)?e:null});e.length>1&&r.unshift(e),t(r)}else t([])}function t(e,t){var n,o;return n=i.MetaAliasService.getAlias(e),n&&(o=i.MetaAliasService.parseMetaFromTemplate(t),n=i.MetaAliasService.selectCandidateName(n,o)),n}var n=this.$scope,i=this;this.$element;if(n.templateEditorCommonConfig){this.entities=n.templateEditorCommonConfig.entities,this.mode=n.templateEditorCommonConfig.mode;var o=n.templateEditorCommonConfig.onTextcompleteCallback||angular.noop;this.strategies=[{parseFn:function(e){var t,n=e.length,i=k.a.collectMeta(e,function(){});if(i.length){var o=i[i.length-1];o.stop===n&&"alias"!=o.type&&(t=o,t.text=e.substring(t.start,t.stop))}return t},search:e,index:2,replace:function(e){var n,a;n=t(e,i.currentMessage),a=n?":":"";var r=e+a;return i.$timeout(function(){o(r)},0),r},maxCount:50},{prefix:void 0,parseFn:function(e){var t,n=e.length,i=k.a.collectMeta(e,function(){});if(i.length){var o=i[i.length-1];o.stop===n&&"alias"===o.type&&(t=o,t.text=e.substring(t.start,t.stop))}return t},search:function(e,o){if(n.ngModel&&void 0!==n.ngModel.isTemplate&&!1===n.ngModel.isTemplate)return void o([]);if(":"===e[e.length-1]){var a=e.slice(0,-1),r=t(a,i.currentMessage);if(!r)return;r&&(e+=r),n.templateEditorCommonConfig.nameToAliasMap.pushToMap(a,r)}var s=k.a.collectMeta(e,function(){});if(s.length>0){var l=s[s.length-1],c=i.MetaAliasService.metaOfNode(l);this.prefix=c+":";var u=i.MetaAliasService.aliasOfNode(l);0===u.indexOf("<")&&(u="");var p=n.templateEditorCommonConfig.nameToAliasMap.map,f=p[c]||[];u&&(f=f.filter(function(e){return e.toLowerCase().indexOf(u.toLowerCase())>=0}),f=f.filter(function(e){return e!==u}),f.unshift(u)),o(f)}else this.prefix=e,o([])},index:2,replace:function(e){var t=this.prefix+e+" ";return i.$timeout(function(){o(t)},0),t},maxCount:50}]}}},{key:"postInit",value:function(){var e=this.$scope,t=this,n=this.$element;n.keyup(function(t){8===t.which&&e.deactivateList()}),"entityEntryTableMode"!==t.mode?(n.keydown(function(t){n.trigger("change"),13===t.which&&e.shown&&(t.preventDefault(),t.stopPropagation())}),n.change(function(n){t.currentMessage=b.a.glueClean(e.ngModel)})):n.change(function(n){t.currentMessage=e.ngModel})}},{key:"postOnSelect",value:function(){var e=this.$scope,t=this,n=this.$element.val();if("entityEntryTableMode"===t.mode)return e.ngModel=n,void e.templateEditorCommonConfig.nameToAliasMap.updateFromTemplate(n);t.$timeout(function(){e.templateEditorCommonConfig.nameToAliasMap.updateFromTemplate(e.ngModel)})}}]),t}(w.a);_=C([n.i(x.a)({restrict:"EA",scope:{ngModel:"=",templateEditorCommonConfig:"=completerTemplateEditor"}})],_),t.a=_},127:function(e,t,n){"use strict";var i=n(0),o=n.n(i),a=n(1),r=n.n(a),s=n(9),l=n.n(s),c=n(5),u=n.n(c),p=n(10),f=n.n(p),h=n(11),d=n(85),m=this&&this.__decorate||function(e,t,n,i){var o,a=arguments.length,r=a<3?t:null===i?i=f()(t,n):i;if("object"===("undefined"==typeof Reflect?"undefined":u()(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,n,r):o(t,n))||r);return a>3&&r&&l()(t,n,r),r};n(349);var v=function(){function e(t,n,i){o()(this,e),this.$compile=t,this.$scope=n,this.$timeout=i,this.activeIndex=0}return e.$inject=["$compile","$scope","$timeout"],r()(e,[{key:"link",value:function(e,t,n){var i=this;this.$list=t.find(".completer__list"),e.onKeyDown=function(t){e.shown&&(27===t.keyCode?e.deactivateList():38===t.keyCode?(t.preventDefault(),0===i.activeIndex?i.activeIndex=e.data.length-1:i.activeIndex-=1,i.scrollToActive()):40===t.keyCode?(t.preventDefault(),i.activeIndex===e.data.length-1?i.activeIndex=0:i.activeIndex+=1,i.scrollToActive()):13!==t.keyCode&&9!==t.keyCode&&32!==t.keyCode||(t.preventDefault(),e.select(i.activeIndex)),e.$apply())},e.onClick=function(t,n){t.preventDefault(),t.originalEvent.keepTextCompleteDropdown=!0,i.$timeout(function(){e.select(n)})},e.select=function(t){e.completer.onSelect(e.data[t]),e.deactivateList()},e.render=function(t){e.data=t,e.data.length?i.scrollToActive():e.deactivateList()},e.clearList=function(){e.data=[],i.activeIndex=0},e.setPosition=function(t){t.visibility="hidden",e.position=t,i.$timeout(function(){e.position=i.calcOffsetList(t),e.position.visibility="visible"}),e.$apply()},e.activateList=function(){e.shown||(e.shown=!0)},e.deactivateList=function(){e.shown&&(e.shown=!1,e.data=i.activeIndex=null)}}},{key:"calcOffsetList",value:function(e){var t=this.$scope.completer.$element,n=e,i=t.offset(),o=this.$list.outerHeight(!1),a=window.innerHeight,r=$(document).scrollTop(),s=16;o+=s,n.left+=i.left,n.top+=i.top;var l=a+r-(n.top+o);l<0&&(n.top+=l),n.top-r<s&&(n.top+=s-n.top+r);var c=parseInt($("body").css("top"));return n.top-=c,n}},{key:"$onDestroy",value:function(){this.$scope.deactivateList()}},{key:"scrollToActive",value:function(){var e=this.$list.find(".completer__list_wrapper"),t=this.$list.find(".completer__list_item"),n=e.outerHeight(!1),i=t.outerHeight(!1),o=e.scrollTop(),a=o+n,r=this.activeIndex*i,s=r+i,l=d.a.normalise(e.css("padding-top"))+d.a.normalise(e.css("padding-bottom"))+d.a.normalise(e.css("border-top-width"))+d.a.normalise(e.css("border-bottom-width"));r<o?e.scrollTop(r):s>a-l&&e.scrollTop(s-n+l)}}]),e}();v=m([n.i(h.a)({restrict:"EA",template:n(330)})],v),t.a=v},286:function(e,t,n){t=e.exports=n(7)(),t.push([e.i,"/* Mixin */\n.completer__wrapper {\n  position: relative;\n  display: block;\n}\n.completer__list {\n  background: #fff;\n  max-height: 400px;\n  float: left;\n  text-align: left;\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 100;\n  min-width: 200px;\n  -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);\n  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);\n  padding: 8px 0;\n}\n.completer__list .completer__list_wrapper {\n  padding: 0;\n  overflow: auto;\n  max-height: 384px;\n  min-width: 200px;\n}\n.completer__list .completer__list_item.selected {\n  background-color: rgba(158, 158, 158, 0.2);\n}\n",""])},330:function(e,t){e.exports='<div class="completer__list ng-hide" ng-show="shown" ng-style="position">\n    <md-menu-content class="completer__list_wrapper">\n        <md-menu-item class="completer__list_item"\n                      ng-repeat="item in data track by $index"\n                      ng-click="onClick($event, $index)"\n                      ng-class="{ selected: $index === vm.activeIndex }">\n            <md-button>\n                {{ item }}\n            </md-button>\n        </md-menu-item>\n    </md-menu-content>\n</div>'},349:function(e,t,n){var i=n(286);"string"==typeof i&&(i=[[e.i,i,""]]);n(8)(i,{});i.locals&&(e.exports=i.locals)},353:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(125),o=n(126),a=n(127),r=angular.module("api.directives",[]);r.directive("completer",i.a).directive("completerTemplateEditor",o.a).directive("completerList",a.a),t.default=r},84:function(e,t,n){"use strict";var i=n(0),o=n.n(i),a=n(1),r=n.n(a),s=n(85),l=function(){function e(t,n,i,a,r,l,c,u){o()(this,e),this.$compile=t,this.$sanitize=n,this.$scope=i,this.$element=a,this.$timeout=r,this.MetaAliasService=l,this.UtilsService=c,this.AnnotateHelperService=u,this.search=s.a.lock(function(e,t){var n,i=this.$scope;i.strategy=t[0],n=t[1],i.strategy.search(n,this.searchCallbackFactory(e))});var p=this;this.element=this.$element.get(0),this.strategies=i.strategies,i.completer=this,this.preInit();var f=this.element===document.activeElement;this.$element.wrap('<div class="completer__wrapper"></div>'),f&&this.element.focus(),this.scopeCompleterListNew=i,this.initList(),this.preparation(),i.onKeyUp=function(e){p.onKeyUp(e)},a.on("keyup",i.onKeyUp),a.on("keydown",i.onKeyDown),this.postInit(),$(document).on("click",s.a.bind(function(e){e.originalEvent&&!e.originalEvent.keepTextCompleteDropdown&&this.$timeout(function(){return i.deactivateList()})},this))}return e.$inject=["$compile","$sanitize","$scope","$element","$timeout","MetaAliasService","UtilsService","AnnotateHelperService"],r()(e,[{key:"link",value:function(e,t,n){}},{key:"$onDestroy",value:function(){this.$completerListElement.remove()}},{key:"preInit",value:function(){}},{key:"postInit",value:function(){}},{key:"initList",value:function(){this.$completerListElement=angular.element("<completer-list></completer-list>"),$("body").append(this.$compile(this.$completerListElement)(this.scopeCompleterListNew))}},{key:"preparation",value:function(){var e,t;for(e in this.strategies)this.strategies.hasOwnProperty(e)&&(t=this.strategies[e],t.template||(t.template=this.identity.bind(this)),null==t.index&&(t.index=2),t.cache&&(t.search=s.a.memoize(t.search)),t.maxCount=t.maxCount||10)}},{key:"identity",value:function(e){return this.$sanitize(e)}},{key:"onKeyUp",value:function(e){var t,n,i=this.$scope;if(t=this.extractSearchQuery(this.getTextFromHeadToCaret()),t.length){if(n=t[1],this.term===n)return;this.term=n,this.search(t)}else this.term=null,i.deactivateList()}},{key:"onSelect",value:function(e,t){var n,i,o,a=this.$scope;if(n=this.getTextFromHeadToCaret(),"true"===this.element.contentEditable||(i=this.element.value.substring(this.element.selectionEnd)),o=a.strategy.replace(e),angular.isArray(o)&&(i=o[1]+i,o=o[0]),a.strategy.match)n=n.replace(a.strategy.match,o);else if(a.strategy.parseFn){var r=a.strategy.parseFn(n);n=n.substring(0,r.start)+o+n.substring(r.stop)}if("true"===this.element.contentEditable){if(document.execCommand("insertText",!1,o),r&&r.text){var s=r.text.length;rangy.getSelection().move("character",-(s+o.length));for(var l=0;l<s;l++)document.execCommand("forwardDelete",!1);rangy.getSelection().move("character",o.length)}}else this.$element.val(n+i);this.postOnSelect(),this.element.focus(),this.element.selectionStart=this.element.selectionEnd=n.length}},{key:"postOnSelect",value:function(){}},{key:"extractSearchQuery",value:function(e){var t,n,i,o;for(t in this.strategies)if(this.strategies.hasOwnProperty(t)){if(n=this.strategies[t],n.match&&(i=e.match(n.match)))return[n,i[n.index]];if(n.parseFn&&(o=n.parseFn(e)))return[n,o.text]}return[]}},{key:"getCaretPosition",value:function(){if(0!==this.element.selectionEnd){var e,t,n,i,o;for(e=["border-width","font-family","font-size","font-style","font-variant","font-weight","height","letter-spacing","word-spacing","line-height","text-decoration","width","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left"],t=angular.extend({position:"absolute",overflow:"auto","white-space":"pre-wrap",top:0,left:-9999},s.a.getStyles(this.$element,e)),n=$("<div></div>").css(t),n.text(this.getTextFromHeadToCaret()),i=$("<span></span>").text("&nbsp;").appendTo(n),this.$element.before(n),o=i.position();o.left>this.$element.width();)o.left=o.left-this.$element.width();return o.top+=i.height()-this.$element.scrollTop(),n.remove(),o}}},{key:"getTextFromHeadToCaret",value:function(){var e,t,n;if("number"==typeof(t=this.element.selectionEnd)&&"true"!==this.element.contentEditable)e=this.element.value.substring(0,t);else if(document.selection)n=this.element.createTextRange(),n.moveStart("character",0),n.moveEnd("textedit"),e=n.text;else if("true"===this.element.contentEditable){n=window.getSelection().getRangeAt(0);var i=n.cloneRange();i.selectNodeContents(this.element),i.setEnd(n.startContainer,n.startOffset),e=i.toString()}return e}},{key:"searchCallbackFactory",value:function(e){var t=this;return function(n,i){t.renderList(n),i||(e(),t.clearAtNext=!0)}}},{key:"renderList",value:function(e){var t=this.$scope;this.clearAtNext&&(t.clearList(),this.clearAtNext=!1),e.length&&(t.shown||t.clearList(),e=e.slice(0,t.strategy.maxCount),t.render(e),t.activateList(),t.setPosition(this.getCaretPosition())),t.data&&t.data.length||!t.shown||t.deactivateList()}}]),e}();t.a=l},85:function(e,t,n){"use strict";var i=n(0),o=n.n(i),a=n(1),r=n.n(a);n.d(t,"a",function(){return s});var s=function(){function e(){o()(this,e)}return r()(e,null,[{key:"setCompleter",value:function(e){this.completer=e}},{key:"getCompleter",value:function(){return this.completer}},{key:"memoize",value:function(e){var t={};return function(n,i){t[n]?i(t[n]):e.call(this,n,function(e){t[n]=(t[n]||[]).concat(e),i.apply(null,arguments)})}}},{key:"include",value:function(e,t){var n,i;if(e.indexOf)return-1!=e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return!0;return!1}},{key:"lock",value:function(e){var t,n;return t=function(){n=!1},function(){var i;if(!n){n=!0;for(var o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];i=a,i.unshift(t),e.apply(this,i)}}}},{key:"bind",value:function(e,t){return e.bind?e.bind(t):function(){e.apply(t,arguments)}}},{key:"toArray",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.prototype.slice.call(t)}},{key:"normalise",value:function(e){return+e.match(this.DIGIT_EGEXP)[1]}}]),e}();s.DIGIT_EGEXP=/(\d+)/,s.completer=null,s.getStyles=function(){var e;return e=$("<div></div>").css("color"),void 0!==e?function(e,t){return e.css(t)}:function(e,t){var n;return n={},angular.forEach(t,function(t){n[t]=e.css(t)}),n}}()}},[353]);